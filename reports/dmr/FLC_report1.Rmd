---
title: FLC Monitoring
author: Sea State
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  pdf_document:
    fig_caption: false
fontsize: 10pt
geometry: margin=0.75in
fig.env: graphicx
---

```{r global_options, include=FALSE, warning=FALSE, message=FALSE, echo=FALSE}
knitr::opts_chunk$set(fig.width=7.0, fig.height=2.0, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)
library(pander)
```

```{R,runFLCscript}
	source("FLC_report1.R")
	source("FLC_FleetReport.R")
```



### Overview

```{R,OverviewTable}
	library(pander)
  panderOptions('digits', 2)
  panderOptions('round', 2)
  panderOptions('keep.trailing.zeros', TRUE)
  panderOptions('big.mark', ",")
  panderOptions('keep.line.breaks', TRUE)
  pander(x=OverviewTable, 
  	caption=paste0("Catch statistics for week ending ",Period$eow," (Week ", .WEEK, ")."),justify='right')
```


```{R,codCatch,fig.margin = FALSE}
	G2 + theme_bw(base_size=10)
```



### NMFS stat area summary
```{R,catchSummary}
	library(pander)
  panderOptions('digits', 2)
  panderOptions('round', 2)
  panderOptions('keep.trailing.zeros', TRUE)
  panderOptions('big.mark', ",")
  pander(x=statAreaRates, keep.line.breaks = TRUE, caption=paste0("Halibut encounter rates for the week ending ",Period$eow,"."),justify='right')
```



### Vessel Rates and Ranking
```{R,vesselRates}
	pander(vesselRates,
					justify=c('center','left','center','center'),
					caption=paste0("Vessel Rates in kg of halibut per ton of groundfish for the week ending ",Period$eow, "."),
					split.cells=c(10,190,15,15))
```




### Viability sampling
Total number of hauls sampled to date is 
`r prettyNum(NumberOfHaulsSampled[2,2],big.mark=",")`, and the total number of Hauls sampled in `r NumberOfHaulsSampled[1,1]` was `r prettyNum(NumberOfHaulsSampled[1,2],big.mark=",")`.

```{R,ViabilitySummary}
	library(pander)
  panderOptions('digits', 2)
  panderOptions('round', 2)
  panderOptions('keep.trailing.zeros', TRUE)
	
	today = .TODAY-1
	set.caption(paste("Viability samples as of",today), permanent = FALSE)
	pander(TBL_1)
```



### Discard mortality rates
The year to date discard mortality rate based on all viability sampling is `r library(scales); percent(weighted.mean(mr,counts$ytd,na.rm=TRUE))`. 
 In the previous 2-weeks the rate was `r percent(weighted.mean(mr,counts$p2w,na.rm=TRUE))`. In the last week `r percent(weighted.mean(mr,counts$p1w,na.rm=TRUE))`.

### Catch-to-date by gear type.
Show a table with the breakdown of BSAI groundfish catch & bycatch by gear types: HAL, NPT, POT, PTR, ALL.

### Blue King Crab
Show BKC catch-to-date by fishing area, and report the number caught in the Prib's Zone.  Simple table will suffice.


### Halibut hotspots
Heat map based on the halibut encounter rates in the H\&L CP fishery.

How this will eventually work, I'm just calculating the nearest neighbor density for all sets in the past week where the halibut encounter rate is greather than the median rate of all sets for that week.  For now the rate is based on (kg Halibut pre mortality)/(Official Total Catch)

```{R,fig.width=4,fig.height=4}
	#bmap
```

